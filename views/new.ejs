<h2>Add New Participant</h2>

<form action="/new" method="POST" id="participantForm">
  <table border="0" width="80%">
    <tr>
      <td colspan="4" style="text-align: right;">
        <a href="/">Return to Dashboard</a>
      </td>
    </tr>

    <tr>
      <td style="width: 20%;">
        <p><label>Participant Name</label></p>
      </td>
      <td style="width: 30%;"><input name="name" required></td>
      <td style="width: 20%;">
        <p><label>Participant Enterprise</label></p>
      </td>
      <td style="width: 30%;"><input name="ent_name" required></td>
    </tr>

    <tr>
      <td style="width: 20%;">
        <p><label>Participant Email</label></p>
      </td>
      <td style="width: 30%;">
        <input name="email" id="email" required>
        <div id="emailError" style="color:red; font-size:0.9em;"></div>
      </td>
      <td style="width: 20%;">
        <p><label>Participant Phone</label></p>
      </td>
      <td style="width: 30%;"><input name="phone" required></td>
    </tr>

    <tr>
      <td style="width: 20%;">
        <p><label>Select Event</label></p>
      </td>
      <td style="width: 30%;">
        <select name="event_id" id="event">
          <option value="">-- Select an event --</option>
          <% if (typeof events !=='undefined' ) { %>
            <% events.forEach(function(event) { %>
              <option value="<%= event.id %>">
                <%= event.title %>
              </option>
              <% }); %>
                <% } %>
        </select>
      </td>
    </tr>

    <tr>
      <td colspan="4" style="text-align: right;"><button type="submit">Create</button></td>
    </tr>
  </table>
</form>

<!-- EMAIL VALIDATION SCRIPT -->
<script>
  document.getElementById("participantForm").addEventListener("submit", function (event)
  {
    const emailField = document.getElementById("email");
    const emailError = document.getElementById("emailError");
    const email = emailField.value.trim();

    // Email regex validation pattern
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    // Clear previous error
    emailError.textContent = "";
    emailField.style.border = "";

    // Validate
    if (!emailPattern.test(email))
    {
      event.preventDefault(); // stop form submission
      emailError.textContent = "Please enter a valid email address (example: user@example.com).";
      emailField.style.border = "2px solid red";
      emailField.focus();
    }
  });
</script>